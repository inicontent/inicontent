import{a as z,H as g,I as L,C as f,h as e,J as w}from"./entry.965cbfb6.js";import{u as P}from"./composables.afeb471a.js";import{u as x}from"./fetch.eef88911.js";import{b as _}from"./index.d4f86f82.js";import{N as B}from"./RenderData.2b7cc39b.js";import{S as M}from"./Settings.a61b5060.js";import{N as p,b as m,U as E,g as I,P as A}from"./Upload.38b41102.js";import{e as O,f as R,h as o,N as Z,T as V,D as F}from"./Trash.b33dcf75.js";import{N as C}from"./text.4d5a7e92.js";import{N as i}from"./Icon.f74efb11.js";import{N as G}from"./RenderSchema.0fe72e56.js";import{a as J,b as H}from"./Upload.0a12a685.js";import{a as S,b as W,c as j,d as h}from"./RenderFields.dc20bf3f.js";import{N as c}from"./Space.f818dfb9.js";import{N as D}from"./headers.07af22ce.js";import{v as X,w as K}from"./FileText.cd6a6f0c.js";import{N as k}from"./useLanguage.253ae023.js";import"./index.32cff159.js";import"./ColorPicker.1807d23f.js";import"./format-length.ad42f3fa.js";import"./Time.9226a68e.js";import"./Scrollbar.bdc26b9c.js";import"./Scrollbar.f1d32ba1.js";import"./Image.503ecb01.js";import"./RichEditor.cdf03c68.js";import"./use-is-composing.b2f0b09a.js";import"./use-houdini.66c23f06.js";import"./vue.runtime.esm-bundler.7083aaa5.js";import"./Add.59e5c432.js";const ke=z({async setup(){const d=g("Loading",()=>({}));d.value.AddNewDatabase=!1;const n=g("database"),U=g("Window",()=>({width:0})),T=L(),s=g("User"),b=O(),v=f(!1),y=f(null),l=f(),q=async()=>{var a;(a=y.value)==null||a.validate(async r=>{if(r)b.error("The inputs are Invalid");else{d.value.AddNewDatabase=!0;const{data:t}=await x(`https://api.inicontent.com/inicontent/db/${l.value.id}!`,{headers:{Authorization:"Basic "+_.Buffer.from(`${s.value.username}:${s.value.password}`).toString("base64")},method:"PUT",body:l.value,initialCache:!1},"$qBkxtNBcUq");t.value.result?(n.value=t.value.result,d.value.AddNewDatabase=!1,v.value=!1,b.success(t.value.message.en)):b.error(t.value.message.en),d.value.AddNewDatabase=!1}})};return P({title:`${n.value.name} | Tables`,link:[{rel:"icon",href:n.value.icon}]}),()=>e(k,{title:"Tables",style:"background: none",bordered:!1},{header:()=>e(w,{to:`${T.params.db_slug}/tables`},()=>e(C,()=>"Tables")),"header-extra":()=>s.value&&s.value.role==="admin"?e(p,{circle:!0,onClick:()=>(l.value=JSON.parse(JSON.stringify(n.value)),v.value=!0)},{icon:()=>e(i,()=>e(M))}):null,default:()=>[s.value&&s.value.role==="admin"?e(G,{show:v.value,"on-update:show":a=>v.value=a,style:{width:U.value.width>600?"600px":"100%"},preset:"card",title:l.value&&l.value.hasOwnProperty("id")?"Update the database":"Create new Database",bordered:!1,size:"huge",segmented:{content:"soft",footer:"soft"}},{default:()=>e(R,{ref:y,model:l.value,rules:{name:{required:!0,message:"Please give your database a name",trigger:["input","blur"]},slug:{required:!0,message:"Please give your database a unique slug",trigger:["input","blur"]},allowed_domains:{required:!0,validator(a,r){if(r){var t=!0;return r.forEach(u=>{u?u==="*"||u.charAt(0)==="#"?t=!0:/(?:https?):\/\/(\w+:?\w*)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/.test(u)||(t=new Error("This is not a valid link")):t=new Error("This field is required")}),t}else return new Error("This field is required")},trigger:["input","blur"]}}},()=>[e(o,{label:"Name",path:"name"},()=>e(m,{value:l.value.name,onUpdateValue:a=>(l.value.name=a,l.value.slug=a.toLowerCase().replace(/ /g,"_").replace(/[^\[a-zA-Zء-ي]-_+/g,""))})),e(o,{label:"Slug",path:"slug"},()=>e(m,{disabled:l.value&&l.value.hasOwnProperty("id"),value:l.value.slug,onUpdateValue:a=>l.value.slug=a.toLowerCase().replace(/ /g,"_").replace(/[^\[a-zA-Zء-ي]-_+/g,"")})),e(o,{label:"Icon",path:"icon"},()=>e(J,{directoryDnd:!0,max:1,multiple:!1,accept:"image/*",action:"https://api.inicontent.com/inicontent/assets",headers:{Authorization:"Basic "+_.Buffer.from(`${s.value.username}:${s.value.password}`).toString("base64")},fileList:l.value.icon?[{id:l.value.icon.split("/").pop().split("#")[0].split("?")[0],name:l.value.icon.split("/").pop().split("#")[0].split("?")[0],status:"finished",url:l.value.icon}]:void 0,onRemove:({file:a})=>(delete l.value.icon,!0),onFinish:({file:a,event:r})=>{const t=JSON.parse(r.target.response).result.public_url;return l.value.icon=t,a.url=t,a.name=t.split("/").pop().split("#")[0].split("?")[0],a},listType:"image"},()=>e(H,()=>[e("div",{style:{"margin-bottom":"12px"}},e(i,{size:48,depth:3},()=>e(E))),e(C,{style:{"font-size":"16px"}},()=>"Click or drag a file to this area to upload")]))),e(o,{label:"Allowed Domains",path:"allowed_domains"},()=>e(S,{value:l.value.allowed_domains,onUpdateValue:a=>l.value.allowed_domains=a},{input:({submit:a,deactivate:r})=>e(m,{onBlur:r,onChange:a},{suffix:()=>e(i,()=>e(I))})})),e(o,{label:"Roles",path:"roles"},()=>{var a;return e(S,{value:["admin","user","guest",...(a=l.value.roles)!=null?a:[]],onCreate:r=>l.value.roles?l.value.roles.push(r.toLowerCase().replace(/ /g,"_").replace(/[^\[a-zA-Zء-ي]-_+/g,"")):l.value.roles=[r.toLowerCase().replace(/ /g,"_").replace(/[^\[a-zA-Zء-ي]-_+/g,"")],renderTag:(r,t)=>e(Z,{type:t>2?"default":"primary",disabled:t<3,closable:t>2,onClose:()=>(l.value.roles.splice(t,1),l.value.roles.length===0?delete l.value.roles:"")},{default:()=>r.charAt(0).toUpperCase()+r.slice(1).replaceAll("_"," ")})})}),e(c,()=>[e(D,()=>"Tables"),e(p,{size:"small",circle:!0,onClick:()=>l.value.tables.push({name:"",slug:"",allowed_methods:{}})},{icon:()=>e(i,()=>e(A))})]),e(W,{columns:[{title:"Name",width:100,key:"name",render(a,r){return e(o,{showLabel:!1,path:`tables.${r}.name`,disabled:a.slug==="user",rule:{required:!0,validator(t,u){return u?!0:new Error("This field is required")},trigger:["input","blur"]}},()=>e(m,{value:a.name,disabled:a.slug==="user",onUpdateValue:t=>(l.value.tables[r].name=t,l.value.tables[r].slug=t.toLowerCase().replace(/ /g,"_").replace(/[^\[a-zA-Zء-ي]-_+/g,""))}))}},{title:"Slug",width:100,key:"slug",render(a,r){return e(o,{disabled:l.value&&l.value.hasOwnProperty("id")||a.slug==="user",showLabel:!1,path:`tables.${r}.slug`,rule:{required:!0,validator(t,u){return u?!0:new Error("This field is required")},trigger:["input","blur"]}},()=>e(m,{disabled:l.value&&l.value.hasOwnProperty("id")||a.slug==="user",value:a.slug,onUpdateValue:t=>l.value.tables[r].slug=["user","assets","session"].includes(t.toLowerCase().replace(/ /g,"_").replace(/[^\[a-zA-Zء-ي]-_+/g,""))?t.toLowerCase().replace(/ /g,"_").replace(/[^\[a-zA-Zء-ي]-_+/g,""):null}))}},{title:"Allowed methods",width:100,key:"allowed_methods",render:(a,r)=>{var t;return["user","guest",...(t=l.value.roles)!=null?t:[]].map(u=>e(o,{label:u.charAt(0).toUpperCase()+u.slice(1).replaceAll("_"," "),path:`tables.${r}.allowed_methods.${u}`},()=>{var N;return e(j,{disabled:a.slug==="user",value:l.value.tables[r]&&l.value.tables[r].allowed_methods?Array.from((N=l.value.tables[r].allowed_methods[u])!=null?N:""):["c","r","u"],onUpdateValue:$=>l.value.tables[r].allowed_methods[u]=$.join(""),itemStyle:"display: flex"},()=>e(c,()=>[e(h,{value:"c",label:"Create"}),e(h,{value:"r",label:"Read"}),e(h,{value:"u",label:"Update"}),e(h,{value:"d",label:"Delete"})]))}))}},{title:"Actions",fixed:"right",align:"center",width:60,key:"actions",render(a,r){return e(p,{strong:!0,secondary:!0,circle:!0,type:"error",disabled:a.slug==="user",onClick(){delete l.value.tables[r]}},{icon:()=>e(i,()=>e(V))})}}],data:l.value.tables.filter(a=>a.slug==="user").length>0?l.value.tables:[...l.value.tables,{name:"User",slug:"user",schema:[{name:"Username",type:"text",required:!0,key:Date.now().toString(36)+Math.random().toString(36).substring(2)},{name:"Password",type:"password",required:!0,key:Date.now().toString(36)+Math.random().toString(36).substring(2)},{name:"Email",type:"email",required:!1,key:Date.now().toString(36)+Math.random().toString(36).substring(2)},{name:"Role",type:"role",required:!0,key:Date.now().toString(36)+Math.random().toString(36).substring(2)}]}],scrollX:700})]),footer:()=>e(c,{justify:"end"},()=>[e(p,{loading:d.value.AddNewDatabase,onClick:q},{default:()=>"Save",icon:()=>e(i,()=>e(F))})])}):null,e(X,{xGap:12,yGap:12,cols:"1 500:2 800:4"},()=>n.value.tables.filter(({slug:a,allowed_methods:r})=>s.value&&(s.value.role==="admin"||a==="user"||r&&r[s.value.role]&&r[s.value.role].includes("r"))).map(a=>e(K,()=>e(w,{to:`/${n.value.slug}/tables/${a.slug}`},()=>e(k,{style:"height: 100%",headerStyle:"height: 100%",hoverable:!0},{header:()=>e(c,()=>[e(B,{borderRadius:50},()=>e(i,{style:"font-style: normal"},()=>a.name.charAt(0))),e(D,{style:"margin-bottom: 0"},()=>a.name)]),"header-extra":()=>e(c,()=>[s.value&&s.value.role&&(s.value.role==="admin"||a.allowed_methods&&a.allowed_methods[s.value.role]&&a.allowed_methods[s.value.role].includes("c"))?e(w,{to:`/${n.value.slug}/tables/${a.slug}/new`},()=>e(p,{circle:!0},{icon:()=>e(i,()=>e(A))})):null])})))))]})}});export{ke as default};
